<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pixel Slots</title>
    <link rel="stylesheet" href="style.css">
    
    <!-- Telegram WebApp -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen">
        <div class="loader"></div>
        <p>Loading...</p>
    </div>

    <!-- Game Screen -->
    <div id="game-container" style="display: none;">
        <div id="game-header">
            <div id="balance-container">
                <span>Balance:</span>
                <span id="balance">$0.00</span>
            </div>
            <div id="jackpot-container">
                <span>Jackpot:</span>
                <span id="jackpot">$0.00</span>
            </div>
        </div>

        <div id="slot-machine">
            <div class="reel"><div class="symbol">üé∞</div></div>
            <div class="reel"><div class="symbol">üé∞</div></div>
            <div class="reel"><div class="symbol">üé∞</div></div>
        </div>

        <div id="controls">
            <div id="bet-controls">
                <button id="decrease-bet">-</button>
                <span id="current-bet">$0.10</span>
                <button id="increase-bet">+</button>
            </div>
            <button id="max-bet">MAX BET</button>
            <button id="spin-button" disabled>SPIN!</button>
            <button id="auto-play">AUTO</button>
        </div>

        <div id="win-table">
            <div class="win-row">
                <span>üé∞ üé∞ üé∞</span>
                <span>JACKPOT</span>
            </div>
            <div class="win-row">
                <span>7Ô∏è‚É£ 7Ô∏è‚É£ 7Ô∏è‚É£</span>
                <span>x20</span>
            </div>
            <div class="win-row">
                <span>üíé üíé üíé</span>
                <span>x10</span>
            </div>
            <div class="win-row">
                <span>üçä üçä üçä</span>
                <span>x4</span>
            </div>
            <div class="win-row">
                <span>üçã üçã üçã</span>
                <span>x3</span>
            </div>
            <div class="win-row">
                <span>üçí üçí üçí</span>
                <span>x2</span>
            </div>
        </div>
    </div>

    <div id="win-overlay">
        <div id="win-content">
            <h2>YOU WIN!</h2>
            <p id="win-amount">$0.00</p>
            <button id="collect-win">COLLECT</button>
        </div>
    </div>

    <!-- Game Scripts -->
    <script>
        // Debug mode
        window.DEBUG = true;
        window.log = (...args) => window.DEBUG && console.log(...args);

        // Initialize Supabase
        const supabaseUrl = 'https://vcspybmymfmxhvqeehkp.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZjc3B5Ym15bWZteGh2cWVlaGtwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzE2OTU3NzEsImV4cCI6MjA0NzI3MTc3MX0.wyzWwNd5F0HDjKCRPnSZ7vXajh6XVa9t0TjU5PG6P7I';
        
        window.log('Initializing Supabase...');
        const { createClient } = supabase;
        window.supabase = createClient(supabaseUrl, supabaseKey);

        // Initialize Telegram WebApp
        window.addEventListener('load', async () => {
            try {
                window.log('Page loaded, initializing...');
                
                // Initialize Telegram
                const tg = window.Telegram.WebApp;
                if (!tg) {
                    throw new Error('Please open in Telegram!');
                }

                // Set theme
                tg.expand();
                tg.setHeaderColor('#1a1a1a');
                tg.setBackgroundColor('#1a1a1a');
                tg.enableClosingConfirmation();

                window.log('=== INITIALIZATION ===');
                window.log('Telegram:', tg);
                window.log('User:', tg.initDataUnsafe?.user);
                window.log('Platform:', tg.platform);
                window.log('Version:', tg.version);

                // Check if user exists
                const user = tg.initDataUnsafe?.user;
                if (!user || !user.id) {
                    throw new Error('Please open in Telegram!');
                }

                // Initialize game
                window.game = new PixelSlots();

                // Hide loading screen
                document.getElementById('loading-screen').style.display = 'none';
                // Show game
                document.getElementById('game-container').style.display = 'block';

                // Mark as ready
                tg.ready();
            } catch (error) {
                window.log('Initialization error:', error);
                alert('Error: ' + error.message);
            }
        });
    </script>
    
    <!-- Game Script -->
    <script src="game.js"></script>
</body>
</html>
